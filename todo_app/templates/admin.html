{% extends "layout.html" %}
{% block title %}To-Do App{% endblock %}

{% block content %}
  <div class="home-link">
    <a class="btn-primary" href="/">Return to home</a>
  </div>
  <div class="jumbotron">
    <h1 class="display-4">Admin settings</h1>
  </div>

  <div class="col-md-12">
    <div class="row">
      <div class="col-md-12">
        <h2>Users</h2>
          <div class="grid-header">
            <div>Username</div>
            <div>User ID</div>
            <div>Role</div>
            <div>Actions</div>
          </div>
    
          <!-- User 1 Row -->
          {% for user in view_model.users %}
          <div class="user-row">
            <div>{{ user.username }}</div>
            <div>{{ user.user_id }}</div>
            <div>{{ user.role }}</div>
            <div class="actions">
              <button class="action-button" onClick="editUser('delete_user','{{ user.user_id }}')">Delete user</button>
              <button class="action-button" onClick="editUser('toggle_admin','{{ user.user_id }}')">Toggle admin</button>
            </div>
          </div>
        {% endfor %}

      </div>
    </div>
  </div>

<style>
  body {
    background-color: #f8f9fa;
    padding-top: 20px;
  }
  .jumbotron {
    color: #fff;
    text-align: center;
    padding: 2rem 1rem;
    margin-bottom: 20px;
    background-color: darkgreen;
    border-style: dotted;
    border-radius: 2em;
  }
  .btn-primary  {
      text-decoration: none;
      color: white;
      border-color: grey;
      background-color: grey; 
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 1.1rem;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      margin-bottom: 1em;
      margin-right: 0.5em;
  }
  .btn-primary:hover {
      background-color: darkgrey; 
      text-decoration: none;
      color: white;
  }
  .btn-primary:active {
      background-color: grey; 
      box-shadow: 0 2px 4px grey;
  }
  .home-link {
      display: flex;
      justify-content: right;
      margin-top: 20px;
  }
  .grid-container {
      display: grid;
      gap: 0.5rem;
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
    }
    .grid-header {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 1rem;
      font-weight: bold;
      text-align: center;
      padding: 0.75rem;
      background-color: #333;
      color: #fff;
      border-radius: 8px 8px 0 0;
    }
    .user-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem;
      background-color: #ffffff;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    .user-row:nth-child(even) {
      background-color: #f9f9f9;
    }
    .action-button {
      padding: 0.4rem 0.8rem;
      background-color: grey;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      margin-bottom: 2px;
      width: 8em;
    }
    .action-button:hover {
      background-color: lightgrey;
    }
    @media (max-width: 600px) {
      .grid-header, .user-row {
        grid-template-columns: 1fr 1fr;
      }
    }
</style>

<script>
  const editUser = function(action,userId) {
      fetch(`/${action}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ userId: userId })
      })
      .then(response => response.json()) 
      .then(data => {
          if (data.success) {
              window.location.href = '/admin';
          } else {
              window.location.href = '/unauthorised';
          }
      })
  }

</script>
{% endblock %}
